<html DIR="LTR" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
  <head>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=utf-8" />
    <META NAME="save" CONTENT="history" />
    <title>OnPreviewClose Method</title>
    
    <link rel="stylesheet" type="text/css" href="../local/Classic.css">
      
    </link>
    
    <script src="../local/EventUtilities.js">
      
    </script>
    <script src="../local/SplitScreen.js">
      
    </script>
    <script src="../local/Dropdown.js">
      
    </script>
    <script src="../local/script.js">
      
    </script>
  </head>
  <body>
    <input type="hidden" id="userDataCache" class="userDataStyle">
    </input>
    <input type="hidden" id="hiddenScrollOffset">
    </input>
    <img id="dropDownImage" style="display:none; height:0; width:0;" alt="Filter choices image" src="../local/drpdown.gif">
      
      
    </img>
    <img id="dropDownHoverImage" style="display:none; height:0; width:0;" alt="DropDownHover image" src="../local/drpdown_orange.gif">
      
      
    </img>
    <img id="collapseImage" style="display:none; height:0; width:0;" alt="Collapse image" src="../local/collapse_all.gif">
      
      
    </img>
    <img id="expandImage" style="display:none; height:0; width:0;" alt="Expand image" src="../local/expand_all.gif">
      
      
    </img>
    <img id="collapseAllImage" style="display:none; height:0; width:0;" alt="CollapseAll image" src="../local/collall.gif">
      
      
    </img>
    <img id="expandAllImage" style="display:none; height:0; width:0;" alt="ExpandAll image" src="../local/expall.gif">
      
      
    </img>
    <img id="copyImage" style="display:none; height:0; width:0;" alt="Copy image" src="../local/copycode.gif">
      
      
    </img>
    <img id="copyHoverImage" style="display:none; height:0; width:0;" alt="CopyHover image" src="../local/copycodeHighlight.gif">
      
      
    </img>
    <div id="header">
      <table width="100%" id="topTable">
        <tr id="headerTableRow1">
          <td align="left">
            <span id="runningHeaderText">
              Visual FoxPro 9.0 SP2
            </span>
          </td>
        </tr>
        <tr id="headerTableRow2">
          <td align="left">
            <span id="nsrTitle">OnPreviewClose Method</span>
          </td>
        </tr>
        <tr id="headerTableRow3">
          <td>
            <a href="#seeAlsoToggle" onclick="OpenSection(seeAlsoToggle)">See Also</a> 
									<a href="#codeExampleToggle" onclick="OpenSection(codeExampleToggle)">Example</a></td>
        </tr>
      </table>
      <table width="100%" id="bottomTable" cellspacing="0" cellpadding="0">
        <tr>
          <td>
            <span onclick="ExpandCollapseAll(toggleAllImage)" style="cursor:default;" onkeypress="ExpandCollapseAll_CheckKey(toggleAllImage)" tabindex="0">
              <img ID="toggleAllImage" class="toggleAll" alt="CollapseAll image" src="../local/collall.gif">
                
                
              </img>
              <label id="collapseAllLabel" for="toggleAllImage" style="display: none;">
                Collapse All
              </label>
              <label id="expandAllLabel" for="toggleAllImage" style="display: none;">
                Expand All
              </label> </span>
            <!-- VFPX languageFilterToolTip removed -->
          </td>
        </tr>
      </table>
      <!-- VFPX languageSpan removed-->
    </div>
    <div id="mainSection">
      <div id="mainBody">
        <div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()">
        </div>
        <font color="DarkGray"></font><p />
    <p>Occurs when the user closes a report preview or opts to print from a report preview.</p>
  <div id="syntaxSection" class="section"><div id="syntaxCodeBlocks" class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"></th></tr><tr><td><pre>
oReportListener.OnPreviewClose([lPrint])</pre></td></tr></table></span></div></div><p /><h4 class="subHeading">Parameters</h4>
    
      <dl><dt><span class="nonLinkTerms">
          <span class="parameter">lPrint</span>
        </span></dt><dd>
          <p>Specifies whether the user indicated a desire to print the pages in the current output page set after closing the report preview. </p>
        </dd></dl>
    
  <h1 class="heading"><span onclick="ExpandCollapse(returnValueToggle)" style="cursor:default;" onkeypress="ExpandCollapse_CheckKey(returnValueToggle)" tabindex="0"><img id="returnValueToggle" onload="OnLoadImage()" class="toggle" name="toggleSwitch" alt="Expand image" src="../local/expand_all.gif"></img>Return Value</span></h1><div id="returnValueSection" class="section" name="collapseableSection" style="display: none;">
    
      <p>None.</p>
    
  </div><h1 class="heading"><span onclick="ExpandCollapse(remarksToggle)" style="cursor:default;" onkeypress="ExpandCollapse_CheckKey(remarksToggle)" tabindex="0"><img id="remarksToggle" onload="OnLoadImage()" class="toggle" name="toggleSwitch" alt="Expand image" src="../local/expand_all.gif"></img>Remarks</span></h1><div id="remarksSection" class="section" name="collapseableSection" style="display: none;">
    
      <p>Applies To: <span class="linkTerms"><a href="/html/5709df40-166a-439b-8d9a-9504c1f631c1.htm">ReportListener Object</a></span>.</p>
      <p>The PreviewContainer API specifies that, when the user closes a report preview form, the PreviewContainer must call the ReportListener’s OnPreviewClose method. When the user chooses to print from Preview, Preview calls OnPreviewClose with an argument of True (<code>.T.</code>).  </p>
      <div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" alt="Note" src="../local/note.gif"></img>Note </th></tr><tr><td>
        <p> The ReportListener invokes the PreviewContainer's SetReport method in OnPreviewClose with an argument of NULL (<code>.NULL.</code>).  At this time, the ReportListener can choose to set its PreviewContainer reference to NULL (<code>.NULL.</code>) or retain it. However, according to the conventions of the PreviewContainer API, it is the responsibility of PreviewContainer to remove its back reference to the ReportListener at this time.  For more information, see <span class="linkTerms"><a href="/html/66975043-814c-4886-901c-53d3924ca1bb.htm">The Preview Container API</a></span> and <span class="linkTerms"><a href="/html/b6e4d5f2-b291-45df-86df-0cac4ba2f5c4.htm">PreviewContainer Property</a></span>.</p>
      </td></tr></table></div>
      <p>If the user opted to print from preview, the print run starts after this method finishes. The print run uses cached pages prepared for preview at this point, so the available output exactly matches what the user saw in preview, including any <b>RANGE</b> or scope specifications included in the <b>REPORT FORM</b> command that invoked the preview.</p>
      <p>If the ReportListener's CommandClauses.Prompt value is True (<code>.T.</code>) at this point, the printer setup dialog appears before the print run. The user may alter the specifications with which the report prints.  This value may be True for one of the following reasons:</p>
      <ul><li>
          <p>You used the <b>PROMPT</b> clause on the original <b>REPORT FORM</b> command.</p>
        </li><li>
          <p>The PreviewContainer or ReportListener adjust the CommandClauses.Prompt value dynamically.  </p>
        </li></ul>
      <p>The pages that print are not always the full range of available output pages; they may be some subset of this range.  Fewer than the full number of output pages may print for one of the following reasons:</p>
      <ul><li>
          <p>The user adjusts the page range in the <b>PROMPT</b> dialog.</p>
        </li><li>
          <p>The PreviewContainer or ReportListener adjusts the ReportListener CommandClauses members provided for the purpose of limiting printed output from the OnPreviewClose method.  These members are PrintPageCurrent, PrintRangeFrom, and PrintRangeTo.  For more information, see <span class="linkTerms"><a href="/html/f5f90b33-e6ae-4139-9d13-be1495a87cf6.htm">CommandClauses Property</a></span>.</p>
        </li></ul>
      <p>If you use <b>NOPAGEEJECT</b> to combine multiple reports within a single report run, the value of CommandClauses.Prompt is only significant at the moment the PreviewContainer invokes the print run.  If you have not dynamically adjusted its value, the value of CommandClauses.Prompt has therefore been determined by whether the final <b>REPORT FORM</b> command in the report run included the <b>PROMPT</b> clause. </p>
      <div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" alt="Note" src="../local/note.gif"></img>Important </th></tr><tr><td>
        <p>Because the printer setup dialog appears after the report has been rendered, in response to CommandClauses.Prompt, and because the report was rendered with information gathered from the printer set earlier, there is some potential for a mismatch between the previously-rendered report and the instructions set by the user in the dialog.  For example, the printer chosen in the dialog might have a different printable page size than the original printer.  The printed results in this scenario are determined by the way the chosen printer's driver chooses to handle this page size instruction.</p>
      </td></tr></table></div>
    
  </div><h1 class="heading"><span onclick="ExpandCollapse(codeExampleToggle)" style="cursor:default;" onkeypress="ExpandCollapse_CheckKey(codeExampleToggle)" tabindex="0"><img id="codeExampleToggle" onload="OnLoadImage()" class="toggle" name="toggleSwitch" alt="Expand image" src="../local/expand_all.gif"></img>Example</span></h1><div id="codeExampleSection" class="section" name="collapseableSection" style="display: none;">
    <description xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
      
        <p xmlns="">You can alter the various dynamic members of CommandClauses during the OnPreviewClose method, to print complex page ranges.  In the following code sketch, a derived ReportListener provides a custom dialog to gather a complex page range from a user, and then invokes the native behavior multiple times to print the various page ranges requested by the user.</p>
      
    </description>
    <div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" alt="CopyCode image" src="../local/copycode.gif"></img>Copy Code</span></th></tr><tr><td colspan="2"><pre>PROCEDURE OnPreviewClose(lPrint)
   LOCAL liRange
   IF lPrint
      NODEFAULT
      IF NOT EMPTY(THIS.CommandClauses.PrintPageCurrent
         *user chose "print current page" option from PreviewContainer.
         *Print only that page:
         THIS.CommandClauses.PrintRangeFrom = ;
           THIS.CommandClauses.PrintPageCurrent
         THIS.CommandClauses.PrintRangeTo = ;
           THIS.CommandClauses.PrintPageCurrent
         DODEFAULT(.T.)
      ELSE
         THIS.ShowCustomPageSetupDialog()
         THIS.CommandClauses.Prompt = .F.
         IF EMPTY(THIS.PageRangeArray[1])  
            * no printing is requested
            DODEFAULT(.F.)
         ELSE
            * user chose at least one range;
            * go through the array set up by 
            * the dialog and print the range(s)
            FOR liRange = 1 TO (ALEN(THIS.PageRangeArray,1))
               THIS.CommandClauses.PrintRangeFrom = ;
                 THIS.PageRangeArray[liRange,1]
               THIS.CommandClauses.PrintRangeTo = ;
                 THIS.PageRangeArray[liRange,2]
               DODEFAULT(.T.)
            ENDFOR
         ENDIF
      ENDIF
   ENDIF
ENDPROC</pre></td></tr></table></span></div>
  </div><h1 class="heading"><span onclick="ExpandCollapse(seeAlsoToggle)" style="cursor:default;" onkeypress="ExpandCollapse_CheckKey(seeAlsoToggle)" tabindex="0"><img id="seeAlsoToggle" onload="OnLoadImage()" class="toggle" name="toggleSwitch" alt="Expand image" src="../local/expand_all.gif"></img>See Also</span></h1><div id="seeAlsoSection" class="section" name="collapseableSection" style="display: none;"><h4 class="subHeading">Reference</h4><span class="linkTerms"><a href="/html/5709df40-166a-439b-8d9a-9504c1f631c1.htm">ReportListener Object</a></span><br /><span class="linkTerms"><a href="/html/03726feb-d818-4008-83b7-74f6662b1578.htm">OutputPageCount Property</a></span><br /><span class="linkTerms"><a href="/html/708514e4-041a-4db4-aa55-6935b110dfc6.htm">IncludePageInOutput Method</a></span><br /><h4 class="subHeading">Other Resources</h4><span class="linkTerms"><a href="/html/ca97d4ab-ef98-482f-aeb0-a3840f1d96d5.htm">Methods (Visual FoxPro)</a></span><br /><span class="linkTerms"><a href="/html/6dcddc3f-9944-4ad8-be2f-003610af616a.htm">Language Reference (Visual FoxPro)</a></span><br /><br /></div></div>
      <div id="footer">
        <div class="footerLine">
          <img width="100%" height="3px" alt="Footer image" src="../local/footer.gif">
            
            
          </img>
        </div>
        <!-- VFPX Footer-->
<div>
<img src="../local/vfpXnote.gif" style="float: left; border:0; margin-right:8px;">Microsoft Visual FoxPro 9 SP2 Help file, VFPX Edition v1.08<br />
<a href="https://github.com/VFPX/HelpFile/issues" target="_blank">Send feedback</a> on this topic to the <a href="https://github.com/VFPX/HelpFile/" target="_blank">VFPX Help file project team</a>.<br />
2009-2017 Placed under <a href="http://creativecommons.org/licenses/by/3.0/" target="_blank">Creative Commons licensing</a> by Microsoft Corporation. 
<noscript><p class="vfpx" style="color:#FF0000">&nbsp;&nbsp;<b>Not all help features are available because JavaScript is disabled on this computer!</b></p></noscript>
</div>
<!-- VFPX Footer-->
      </div>
    </div>
  </body>
</html>
<OBJECT type="application/x-oleobject" classid="clsid:1e2a7bd0-dab9-11d0-b93a-00c04fc99f9e">
<param name="ALink Name" value="OnPreviewClose Method">
<param name="ALink Name" value="OnPreviewClose">
<param name="Alink Name" value="vfp.50000912">
</OBJECT>
